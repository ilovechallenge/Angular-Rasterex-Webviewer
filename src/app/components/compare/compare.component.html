<rx-create-comparison
    *ngIf="(createComparisonModalOpened$ | async).opened"
    [otherFileIndex]="(createComparisonModalOpened$ | async).payload?.otherFileIndex"
    [autoConfirm]="(createComparisonModalOpened$ | async).payload?.autoConfirm"
    (onComplete)="onCreateComparisonComplete($event)"
    (onCancel)="onCreateComparisonCancel()">
</rx-create-comparison>

<ng-container *ngIf="(guiMode$ | async) == 'compare' && comparison">
    <div class="actions-menu-container" #edit>
        <ul *ngIf="actionsMenuOpened" class="dropdown-panel">
            <li (click)="editComparisonModalOpened = true; actionsMenuOpened = false;">
                <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M15.5047 3.43218C14.7367 2.66543 13.4929 2.66543 12.7249 3.43218L12.0291 4.13189L4.62197 11.5358L4.60623 11.5516C4.60241 11.5554 4.60241 11.5595 4.59835 11.5595C4.59048 11.5713 4.57868 11.583 4.57093 11.5948C4.57093 11.5987 4.56687 11.5987 4.56687 11.6027C4.559 11.6145 4.55519 11.6224 4.54719 11.6342C4.54338 11.6381 4.54338 11.6419 4.53945 11.646C4.53551 11.6578 4.53157 11.6657 4.52752 11.6775C4.52752 11.6813 4.5237 11.6813 4.5237 11.6853L2.88029 16.6277C2.83208 16.7684 2.86873 16.9243 2.97462 17.0287C3.04902 17.1021 3.14937 17.1432 3.25379 17.1428C3.29646 17.1421 3.33877 17.1354 3.3796 17.1231L8.31771 15.4756C8.32153 15.4756 8.32153 15.4756 8.32558 15.4718C8.33801 15.4681 8.34994 15.4628 8.36088 15.456C8.36396 15.4556 8.36666 15.4542 8.36887 15.4521C8.38056 15.4443 8.3963 15.4363 8.40811 15.4284C8.41979 15.4207 8.43172 15.4089 8.44352 15.401C8.44746 15.3969 8.45127 15.3969 8.45127 15.3931C8.45533 15.3892 8.4632 15.3854 8.46714 15.3774L16.5701 7.27365C17.3368 6.50555 17.3368 5.26171 16.5701 4.49374L15.5047 3.43218ZM8.1919 14.5516L5.45554 11.8151L12.3043 4.96567L15.0407 7.70216L8.1919 14.5516ZM5.07012 12.5425L7.46065 14.9331L3.87104 16.1284L5.07012 12.5425ZM16.0158 6.72313L15.599 7.14389L12.8625 4.40715L13.2834 3.98651C13.7437 3.52651 14.4898 3.52651 14.9503 3.98651L16.0196 5.05594C16.4765 5.5184 16.4748 6.26289 16.0158 6.72313Z" fill="#333C4E" stroke="#333C4E" stroke-width="0.2"/>
                </svg>
                <span>Edit</span>
            </li>
            <li (click)="onAlignClick()">
                <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M6.15323 3.57141C5.75206 3.57141 5.36733 3.72192 5.08366 3.98983C4.79999 4.25774 4.64062 4.6211 4.64062 4.99998V7.85713C4.64062 8.23601 4.79999 8.59937 5.08366 8.86728C5.36733 9.13519 5.75206 9.2857 6.15323 9.2857H11.6994C12.1006 9.2857 12.4854 9.13519 12.769 8.86728C13.0527 8.59937 13.2121 8.23601 13.2121 7.85713V4.99998C13.2121 4.6211 13.0527 4.25774 12.769 3.98983C12.4854 3.72192 12.1006 3.57141 11.6994 3.57141H6.15323ZM12.2036 4.99998V7.85713C12.2036 7.98342 12.1505 8.10454 12.056 8.19384C11.9614 8.28315 11.8332 8.33332 11.6994 8.33332H6.15323C6.01951 8.33332 5.89126 8.28315 5.79671 8.19384C5.70215 8.10454 5.64903 7.98342 5.64903 7.85713V4.99998C5.64903 4.87369 5.70215 4.75257 5.79671 4.66327C5.89126 4.57396 6.01951 4.52379 6.15323 4.52379H11.6994C11.8332 4.52379 11.9614 4.57396 12.056 4.66327C12.1505 4.75257 12.2036 4.87369 12.2036 4.99998Z" fill="#333C4E"/>
                    <path d="M15.9549 10.7143H6.18348C5.77429 10.7143 5.38186 10.8648 5.09252 11.1327C4.80318 11.4006 4.64062 11.764 4.64062 12.1429V15C4.64062 15.3789 4.80318 15.7423 5.09252 16.0102C5.38186 16.2781 5.77429 16.4286 6.18348 16.4286H15.9549C16.3641 16.4286 16.7565 16.2781 17.0459 16.0102C17.3352 15.7423 17.4978 15.3789 17.4978 15V12.1429C17.4978 11.764 17.3352 11.4006 17.0459 11.1327C16.7565 10.8648 16.3641 10.7143 15.9549 10.7143ZM16.4692 15C16.4692 15.1263 16.415 15.2474 16.3186 15.3367C16.2221 15.426 16.0913 15.4762 15.9549 15.4762H6.18348C6.04709 15.4762 5.91627 15.426 5.81983 15.3367C5.72338 15.2474 5.6692 15.1263 5.6692 15V12.1429C5.6692 12.0166 5.72338 11.8955 5.81983 11.8061C5.91627 11.7168 6.04709 11.6667 6.18348 11.6667H15.9549C16.0913 11.6667 16.2221 11.7168 16.3186 11.8061C16.415 11.8955 16.4692 12.0166 16.4692 12.1429V15Z" fill="#333C4E"/>
                    <path d="M2.5 17.3334C2.5 17.4723 2.55268 17.6055 2.64645 17.7037C2.74021 17.802 2.86739 17.8572 3 17.8572C3.13261 17.8572 3.25979 17.802 3.35355 17.7037C3.44732 17.6055 3.5 17.4723 3.5 17.3334V2.66669C3.5 2.52777 3.44732 2.39454 3.35355 2.2963C3.25979 2.19807 3.13261 2.14288 3 2.14288C2.86739 2.14288 2.74021 2.19807 2.64645 2.2963C2.55268 2.39454 2.5 2.52777 2.5 2.66669V17.3334Z" fill="#333C4E"/>
                </svg>
                <span>Align</span>
            </li>
        </ul>
        <button *ngIf="!markupChanged; else saveComparisonTemplate" (click)="actionsMenuOpened = !actionsMenuOpened">
            <span class="title">EDIT</span>
            <svg [class.arrow-up]="actionsMenuOpened" width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M6 8L10 12" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M14 8L10 12" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
        </button>
        <ng-template #saveComparisonTemplate>
            <ul *ngIf="actionsMenuOpened" class="dropdown-panel" style="top: -130px">
                <li (click)="onSaveClick()">
                    <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M13.1339 0H1.875C0.841125 0 0 0.841125 0 1.875V14.125C0 15.1589 0.841125 16 1.875 16H14.125C15.1589 16 16 15.1589 16 14.125V2.86613L13.1339 0ZM4.90625 1.25H8.625V3.625H9.875V1.25H11.125V4.25C11.125 4.59462 10.8446 4.875 10.5 4.875H5.53125C5.18663 4.875 4.90625 4.59462 4.90625 4.25V1.25ZM12.375 14.75H3.65625V9.25C3.65625 8.90537 3.93663 8.625 4.28125 8.625H11.75C12.0946 8.625 12.375 8.90537 12.375 9.25V14.75ZM14.75 14.125C14.75 14.4696 14.4696 14.75 14.125 14.75H13.625V9.25C13.625 8.21613 12.7839 7.375 11.75 7.375H4.28125C3.24738 7.375 2.40625 8.21613 2.40625 9.25V14.75H1.875C1.53038 14.75 1.25 14.4696 1.25 14.125V1.875C1.25 1.53038 1.53038 1.25 1.875 1.25H3.65625V4.25C3.65625 5.28387 4.49738 6.125 5.53125 6.125H10.5C11.5339 6.125 12.375 5.28387 12.375 4.25V1.25H12.6161L14.75 3.38387V14.125Z" fill="#333C4E"/>
                    </svg>
                    <span>Save</span>
                </li>
                <li (click)="onExportPDFClick()">
                    <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M12.5152 5.52026H10.1244V6.93889H12.5152C13.2262 6.93889 13.7778 7.30206 13.7778 7.61463V13.9053C13.7778 14.2179 13.2262 14.581 12.5152 14.581H3.47808C2.76711 14.581 2.2155 14.2179 2.2155 13.9053V7.61487C2.2155 7.3023 2.76711 6.93913 3.47808 6.93913H5.86847V5.5205H3.47808C1.97457 5.5205 0.796875 6.44048 0.796875 7.61487V13.9055C0.796875 15.0802 1.97457 15.9999 3.47808 15.9999H12.5155C14.0187 15.9999 15.1967 15.0799 15.1967 13.9055V7.61487C15.1964 6.44024 14.0187 5.52026 12.5152 5.52026Z" fill="#333C4E"/>
                        <path d="M5.89705 3.53593C6.07864 3.53593 6.25998 3.46666 6.39854 3.3281L7.2866 2.44004V5.52036V6.93898V9.6566C7.2866 10.0484 7.60413 10.3659 7.99591 10.3659C8.38769 10.3659 8.70523 10.0484 8.70523 9.6566V6.93898V5.52036V2.39204L9.64128 3.3281C9.77984 3.46666 9.96142 3.53593 10.1428 3.53593C10.3241 3.53593 10.5057 3.46666 10.6443 3.3281C10.9214 3.05123 10.9214 2.602 10.6443 2.32513L8.52648 0.207356C8.38793 0.0688035 8.20658 0 8.02523 0C8.02334 0 8.02168 0 8.01979 0C8.0179 0 8.01624 0 8.01435 0C7.83301 0 7.65166 0.0688035 7.5131 0.207356L5.39533 2.32513C5.11822 2.602 5.11822 3.05123 5.39533 3.3281C5.53412 3.46666 5.71547 3.53593 5.89705 3.53593Z" fill="#333C4E"/>
                    </svg>
                    <span>Export PDF</span>
                </li>
                <li (click)="onSaveAndExportClick()">
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M14.8604 2H3.60154C2.56767 2 1.72654 2.84113 1.72654 3.875V16.125C1.72654 17.1589 2.56767 18 3.60154 18H15.8515C16.8854 18 17.7265 17.1589 17.7265 16.125V4.86613L14.8604 2ZM6.63279 3.25H10.3515V5.625H11.6015V3.25H12.8515V6.25C12.8515 6.59462 12.5712 6.875 12.2265 6.875H7.25779C6.91317 6.875 6.63279 6.59462 6.63279 6.25V3.25ZM16.4765 16.125C16.4765 16.4696 16.1962 16.75 15.8515 16.75H15.3515H5.38279H4.13279H3.60154C3.25692 16.75 2.97654 16.4696 2.97654 16.125V3.875C2.97654 3.53038 3.25692 3.25 3.60154 3.25H5.38279V6.25C5.38279 7.28387 6.22392 8.125 7.25779 8.125H12.2265C13.2604 8.125 14.1015 7.28387 14.1015 6.25V3.25H14.3427L16.4765 5.38387V16.125Z" fill="#333C4E"/>
                        <path d="M12.1264 12.6074C11.9448 12.6074 11.7635 12.6767 11.6249 12.8152L10.7368 13.7033L10.7368 10.623L10.7368 9.20433L10.7368 9.48671C10.7368 9.09493 10.4193 8.77739 10.0275 8.77739C9.63575 8.77739 9.31821 9.09493 9.31821 9.48671L9.31821 9.20433L9.31821 10.623L9.31821 13.7513L8.38215 12.8152C8.2436 12.6767 8.06202 12.6074 7.88067 12.6074C7.69932 12.6074 7.51774 12.6767 7.37918 12.8152C7.10208 13.0921 7.10208 13.5413 7.37918 13.8182L9.49696 15.936C9.63551 16.0745 9.81686 16.1433 9.99821 16.1433L10.0036 16.1433L10.0091 16.1433C10.1904 16.1433 10.3718 16.0745 10.5103 15.936L12.6281 13.8182C12.9052 13.5413 12.9052 13.0921 12.6281 12.8152C12.4893 12.6767 12.308 12.6074 12.1264 12.6074Z" fill="#333C4E"/>
                    </svg>
                    <span>Save & Export</span>
                </li>
            </ul>
            <button (click)="actionsMenuOpened = !actionsMenuOpened">
                <span>SAVE</span>
                <svg [class.arrow-up]="actionsMenuOpened" width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M6 8L10 12" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M14 8L10 12" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
            </button>
        </ng-template>
    </div>

    <rx-edit-comparison
        *ngIf="editComparisonModalOpened"
        [comparison]="comparison"
        (onCancel)="editComparisonModalOpened = false"
        (onApply)="onEditComparisonApply($event)">
    </rx-edit-comparison>

    <rx-modal-dialog *ngIf="unsavedChanges" class="confirm-dialog">
        <div class="rx-modal-container">
            <div class="rx-modal-body">
                <img (click)="onCancelUnsavedChanges()" class="close" src="/assets/images/close-modal-ico.svg" />
                <h4 class="title">Unsaved changes</h4>
                <p>
                    You have made changes to the comparison. Are you sure to close page without saving?
                </p>
            </div>
            <div class="rx-modal-footer">
                <button class="btn btn-light" (click)="onCancelUnsavedChanges()">Cancel</button>
                <div class="separator"></div>
                <button class="btn btn-secondary" (click)="onDiscardUnsavedChanges()">Discard</button>
                <rx-save-comparison-menu (onSelect)="onSaveOptionSelect($event)"></rx-save-comparison-menu>
            </div>
        </div>
    </rx-modal-dialog>

    <div (click)="onHelpClick()" class="help-button" [class.blue]="window !== top">
        <svg width="18" height="18" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M9 0C4.05668 0 0 4.05668 0 9C0 13.9433 4.05668 18 9 18C13.9433 18 18 13.9433 18 9C18 4.05668 13.9433 0 9 0ZM9 14.8008C8.41859 14.8008 7.94531 14.3275 7.94531 13.7461C7.94531 13.1647 8.41859 12.6914 9 12.6914C9.58141 12.6914 10.0547 13.1647 10.0547 13.7461C10.0547 14.3275 9.58141 14.8008 9 14.8008ZM10.8689 8.91556C10.3436 9.30178 10.0547 9.79513 10.0547 10.3044V11.6367H7.94531V10.3044C7.94531 9.12255 8.55608 7.99629 9.62107 7.21505C9.89659 7.01318 10.0547 6.70264 10.0547 6.36328C10.0547 5.78187 9.58141 5.30859 9 5.30859C8.41859 5.30859 7.94531 5.78187 7.94531 6.36328H5.83594C5.83594 4.61851 7.25523 3.19922 9 3.19922C10.7448 3.19922 12.1641 4.61851 12.1641 6.36328C12.1641 7.36646 11.68 8.32075 10.8689 8.91556Z" fill="#31BD59"/>
        </svg>
    </div>
</ng-container>

<rx-simple-progress *ngIf="progress">
    {{progressMessage}}
</rx-simple-progress>